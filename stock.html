<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Prompt&display=swap');

body { font-family:"Prompt",sans-serif; background:#f4f6f9; margin:5px; }
.container { max-width:100%; margin:auto; background:#fff; padding:15px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
h1 { text-align:center; color:#333; font-size:22px; margin-bottom:10px; }

.btn { padding:10px 12px; border:none; background:#1976d2; color:#fff; border-radius:50px; cursor:pointer; margin:3px; font-size:14px; display:inline-block; min-width:50px; }
.btn:hover { background:#125aa0; }

table { width:100%; border-collapse:collapse; margin-top:10px; font-size:14px; }
th, td { border:1px solid #ccc; padding:6px; text-align:center; font-size:13px; }
th { background:#1976d2; color:white; font-size:14px; }

input[type="text"], input[type="number"], select {
  width:100%; text-align:center; font-size:13px; padding:3px; box-sizing:border-box;
}

.low { background:#ffcccc; }

#reader { width:100%; margin:10px auto; display:none; }

@media print {
  body * { visibility:hidden; }
  #printArea, #printArea * { visibility:visible; }
  #printArea { position:absolute; left:0; top:0; width:100%; }
}
</style>
</head>

<body>
<div class="container">
<h1>üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</h1>

<div style="text-align:center;">
  <button class="btn" onclick="window.location.href='index.html'">üè†</button>
  <button class="btn" id="start-scan">üì∏</button>
  <button class="btn" id="addItemBtn">‚ûï</button>
  <button class="btn" id="saveBtn">üíæ</button>
  <button class="btn" id="export">üìÅ</button>
  <button class="btn" id="printBtn">üñ®Ô∏è</button>
</div>

<div id="reader"></div>

<table id="stockTable">
  <thead>
    <tr>
      <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
      <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
      <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤</th>
      <th>‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</th>
      <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
      <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
      <th>‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</th>
      <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<div id="printArea" style="display:none;">
<h2 style="text-align:center;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h2>
<table style="width:100%; border-collapse:collapse;">
  <thead>
    <tr>
      <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
      <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
      <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤</th>
      <th>‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</th>
      <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
      <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
      <th>‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</th>
    </tr>
  </thead>
  <tbody id="printTable"></tbody>
</table>
</div>

<script>
let items = JSON.parse(localStorage.getItem("stockItems")) || [];
const units = ["‡∏•‡∏±‡∏á","‡∏°‡πâ‡∏ß‡∏ô","‡∏Å‡∏•‡πà‡∏≠‡∏á","‡∏î‡∏≠‡∏Å","‡πÉ‡∏ö","‡∏ï‡∏±‡∏ß","‡∏≠‡∏±‡∏ô","‡∏Å‡∏£‡∏∞‡∏ö‡∏≠‡∏Å","‡∏ñ‡∏∏‡∏á"];

function saveItems() {
  localStorage.setItem("stockItems", JSON.stringify(items));
}

function renderTable() {
  const tbody = document.querySelector("#stockTable tbody");
  tbody.innerHTML = "";
  items.forEach((item,index)=>{
    const inQty = parseInt(item.inQty)||0;
    const outQty = parseInt(item.outQty)||0;
    const remain = inQty - outQty;
    const order = remain<=10?"‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°":"";
    const rowClass = remain<=10?"low":"";
    const row = document.createElement("tr");
    row.className = rowClass;

    let unitOptions = units.map(u=>`<option value="${u}" ${u===item.unit?'selected':''}>${u}</option>`).join("");

    row.innerHTML=`
      <td>${index+1}</td>
      <td>${item.date}</td>
      <td><input type="text" value="${item.name}" onchange="updateItem(${index},'name',this.value)"></td>
      <td><input type="number" value="${item.inQty}" onchange="updateItem(${index},'inQty',this.value)"></td>
      <td><input type="number" value="${item.outQty}" onchange="updateItem(${index},'outQty',this.value)"></td>
      <td>${remain}</td>
      <td><select onchange="updateItem(${index},'unit',this.value)">${unitOptions}</select></td>
      <td>${order}</td>
      <td><button class="btn" style="background:#e53935" onclick="deleteItem(${index})">‚ùå</button></td>
    `;
    tbody.appendChild(row);
  });
}

function updateItem(i,key,value){ items[i][key]=value; saveItems(); renderTable(); }
function addItem(){
  const name = prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:"); if(!name) return;
  const inQty = prompt("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤:","0");
  const outQty = prompt("‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å:","0");
  const unit = prompt(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${units.join(",")}`,units[0]);
  const date = new Date().toLocaleDateString("th-TH");
  items.push({date,name,inQty,outQty,unit});
  saveItems(); renderTable();
}
function deleteItem(i){ if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){ items.splice(i,1); saveItems(); renderTable(); } }

document.getElementById("addItemBtn").addEventListener("click",addItem);
document.getElementById("saveBtn").addEventListener("click",()=>{ saveItems(); alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"); });

document.getElementById("export").addEventListener("click",()=>{
  const ws=XLSX.utils.table_to_sheet(document.getElementById("stockTable"));
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Stock");
  XLSX.writeFile(wb,"stock_items.xlsx");
});

document.getElementById("printBtn").addEventListener("click",()=>{
  const printTbody=document.getElementById("printTable");
  printTbody.innerHTML="";
  items.forEach((item,index)=>{
    const inQty=parseInt(item.inQty)||0;
    const outQty=parseInt(item.outQty)||0;
    const remain=inQty-outQty;
    const order = remain<=10?"‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°":"";
    const row=document.createElement("tr");
    row.innerHTML=`<td>${index+1}</td><td>${item.date}</td><td>${item.name}</td><td>${inQty}</td><td>${outQty}</td><td>${remain}</td><td>${item.unit||''}</td><td>${order}</td>`;
    printTbody.appendChild(row);
  });
  document.getElementById("printArea").style.display="block";
  window.print();
  document.getElementById("printArea").style.display="none";
});

// QR Scanner
const html5QrCode=new Html5Qrcode("reader");
document.getElementById("start-scan").addEventListener("click",()=>{
  document.getElementById("reader").style.display="block";
  Html5Qrcode.getCameras().then(cameras=>{
    if(cameras && cameras.length){
      html5QrCode.start(
        cameras[0].id,
        { fps:10, qrbox:250 },
        decodedText=>{
          const itemName = decodedText;
          const existingIndex = items.findIndex(i=>i.name===itemName);
          const date = new Date().toLocaleDateString("th-TH");

          if(existingIndex>=0){
            const inQty = prompt(`‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ${itemName} ‡∏ã‡πâ‡∏≥! ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°: ${items[existingIndex].inQty} ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô:`, items[existingIndex].inQty);
            const outQty = prompt(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏°: ${items[existingIndex].outQty} ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô:`, items[existingIndex].outQty);
            const unit = prompt(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${units.join(",")}`, items[existingIndex].unit||units[0]);
            items[existingIndex].inQty=inQty; items[existingIndex].outQty=outQty; items[existingIndex].unit=unit; items[existingIndex].date=date;
          }else{
            const inQty=prompt("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤:","0");
            const outQty=prompt("‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å:","0");
            const unit=prompt(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${units.join(",")}`,units[0]);
            items.push({date,name:itemName,inQty,outQty,unit});
          }

          saveItems(); renderTable();
          alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: "+itemName);
          html5QrCode.stop(); document.getElementById("reader").style.display="none";
        },
        errorMessage=>{}
      );
    }
  }).catch(err=>alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: "+err));
});

renderTable();
</script>
</body>
</html>
