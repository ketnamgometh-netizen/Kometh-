<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Prompt&display=swap');
  body { font-family:"Prompt",sans-serif; background:#f4f6f9; margin:10px; }
  .container { max-width:1200px; margin:auto; background:#fff; padding:20px; border-radius:15px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
  h1 { text-align:center; color:#333; }
  .btn { padding:10px 16px; border:none; background:#1976d2; color:#fff; border-radius:6px; cursor:pointer; margin:5px; }
  .btn:hover { background:#125aa0; }
  table { width:100%; border-collapse:collapse; margin-top:15px; }
  th,td { border:1px solid #ccc; padding:8px; text-align:center; }
  th { background:#1976d2; color:white; }
  input[type="text"], input[type="number"] { width:100%; text-align:center; }
  .low { background:#ffcccc; }
  @media print {
    body * { visibility:hidden; }
    #printArea, #printArea * { visibility:visible; }
    #printArea { position:absolute; left:0; top:0; width:100%; }
  }
  </style>
</head>

<body>
  <div class="container">
    <h1>üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h1>
    <div style="text-align:center;">
      <button class="btn" id="addItemBtn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
      <button class="btn" id="export">üìÅ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Excel</button>
      <button class="btn" id="printBtn">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
    </div>

    <table id="stockTable">
      <thead>
        <tr>
          <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤</th>
          <th>‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</th>
          <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
          <th>‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="printArea" style="display:none;">
    <h2 style="text-align:center;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h2>
    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤</th>
          <th>‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</th>
          <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
          <th>‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</th>
        </tr>
      </thead>
      <tbody id="printTable"></tbody>
    </table>
  </div>

<script>
let items = JSON.parse(localStorage.getItem("stockItems")) || [];

function saveItems() {
  localStorage.setItem("stockItems", JSON.stringify(items));
}

function renderTable() {
  const tbody = document.querySelector("#stockTable tbody");
  tbody.innerHTML = "";
  items.forEach((item, index) => {
    const inQty = parseInt(item.inQty) || 0;
    const outQty = parseInt(item.outQty) || 0;
    const remain = inQty - outQty;
    const order = remain <= 10 ? "‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°" : "";
    const rowClass = remain <= 10 ? "low" : "";
    const row = document.createElement("tr");
    row.className = rowClass;
    row.innerHTML = `
      <td>${index + 1}</td>
      <td>${item.date}</td>
      <td><input type="text" value="${item.name}" onchange="updateItem(${index}, 'name', this.value)"></td>
      <td><input type="number" value="${item.inQty}" onchange="updateItem(${index}, 'inQty', this.value)"></td>
      <td><input type="number" value="${item.outQty}" onchange="updateItem(${index}, 'outQty', this.value)"></td>
      <td>${remain}</td>
      <td>${order}</td>
      <td><button class="btn" style="background:#e53935" onclick="deleteItem(${index})">‡∏•‡∏ö</button></td>
    `;
    tbody.appendChild(row);
  });
}

function updateItem(index, key, value) {
  items[index][key] = value;
  saveItems();
  renderTable();
}

function addItem() {
  const name = prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:");
  if (!name) return;
  const inQty = prompt("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤:", "0");
  const outQty = prompt("‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å:", "0");
  const date = new Date().toLocaleDateString("th-TH");
  items.push({ date, name, inQty, outQty });
  saveItems();
  renderTable();
}

function deleteItem(index) {
  if (confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
    items.splice(index, 1);
    saveItems();
    renderTable();
  }
}

document.getElementById("addItemBtn").addEventListener("click", addItem);

document.getElementById("export").addEventListener("click", () => {
  const ws = XLSX.utils.table_to_sheet(document.getElementById("stockTable"));
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Stock");
  XLSX.writeFile(wb, "stock_items.xlsx");
});

document.getElementById("printBtn").addEventListener("click", () => {
  const printTbody = document.getElementById("printTable");
  printTbody.innerHTML = "";
  items.forEach((item, index) => {
    const inQty = parseInt(item.inQty)||0;
    const outQty = parseInt(item.outQty)||0;
    const remain = inQty - outQty;
    const order = remain <= 10 ? "‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°" : "";
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${index + 1}</td>
      <td>${item.date}</td>
      <td>${item.name}</td>
      <td>${inQty}</td>
      <td>${outQty}</td>
      <td>${remain}</td>
      <td>${order}</td>
    `;
    printTbody.appendChild(row);
  });
  document.getElementById("printArea").style.display = "block";
  window.print();
  document.getElementById("printArea").style.display = "none";
});

renderTable();
</script>
</body>
</html>
